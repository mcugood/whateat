<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è¦åƒå•¥ï¼Ÿ - é™„è¿‘åº—å®¶éš¨æ©Ÿé¸æ“‡å™¨</title>
    <!-- è¼‰å…¥ Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* å®šç¾©æ»¾å‹•æ¢æ¨£å¼ï¼Œè®“åˆ—è¡¨çœ‹èµ·ä¾†æ›´ç¾è§€ */
        .custom-scrollbar::-webkit-scrollbar {
            width: 6px;
        }
        .custom-scrollbar::-webkit-scrollbar-thumb {
            background-color: #cbd5e1; /* gray-300 */
            border-radius: 3px;
        }
        .custom-scrollbar {
            scrollbar-width: thin;
            scrollbar-color: #cbd5e1 transparent;
        }
    </style>
</head>
<body class="bg-gray-50 font-sans min-h-screen">

    <!-- ç¶²ç«™æ¨™é¡Œ -->
    <header class="text-center p-4 pt-8">
        <h1 class="text-5xl font-extrabold text-indigo-700 tracking-tighter">
            è¦åƒå•¥ <span class="text-yellow-500">?</span>
        </h1>
        <p class="text-gray-500 mt-2">é›»è…¦éš¨æ©Ÿå¹«æ‚¨é¸æ“‡ï¼Œè§£æ±ºé¸æ“‡å›°é›£ç—‡ï¼</p>
    </header>

    <!-- ç¸½é«”ä½ˆå±€ (Responsive Grid - now a single column) -->
    <main class="max-w-3xl mx-auto p-4 sm:p-8">
        
        <!-- ======================================================= -->
        <!-- å€åŸŸä¸€: é™„è¿‘çš„åº—å®¶åˆ—è¡¨ (å«ç¯©é¸) - ç¾åœ¨æ˜¯å”¯ä¸€çš„å€å¡Š -->
        <!-- ======================================================= -->
        <section id="local-section" class="bg-white p-6 rounded-2xl shadow-xl border-t-4 border-indigo-500 h-full">
            <h2 class="text-2xl font-bold text-gray-800 flex items-center mb-4">
                <!-- MapPin Icon (Lucide SVG) -->
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="w-6 h-6 mr-2 text-indigo-500"><path d="M20 10c0 6-8 12-8 12s-8-6-8-12a8 8 0 0 1 16 0Z"/><circle cx="12" cy="10" r="3"/></svg>
                é™„è¿‘åº—å®¶é¸æ“‡å™¨ (<span id="local-store-count">0</span> é–“)
            </h2>
            
            <!-- ğŸ“ ç›®å‰ä½ç½®è³‡è¨Š & é‡æ–°å®šä½æŒ‰éˆ• (æ–°å¢æ­¤æŒ‰éˆ•) -->
            <div class="flex items-stretch gap-2 mb-4">
                <div id="location-status" class="flex-1 p-3 bg-indigo-50 rounded-lg text-sm text-indigo-700 font-medium flex items-center">
                    <!-- MapPin Icon -->
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="w-4 h-4 mr-2"><path d="M20 10c0 6-8 12-8 12s-8-6-8-12a8 8 0 0 1 16 0Z"/><circle cx="12" cy="10" r="3"/></svg>
                    æ­£åœ¨ç²å–æ‚¨çš„ç›®å‰ä½ç½®...
                </div>
                <button id="re-locate-btn" class="p-3 bg-indigo-500 text-white rounded-lg text-xs font-semibold hover:bg-indigo-600 transition shadow-md whitespace-nowrap flex items-center justify-center">
                    <!-- RotateCcw Icon -->
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="w-4 h-4"><path d="M21 12a9 9 0 0 0-9-9 9.75 9.75 0 0 0-6.76 2.51"/><path d="M3 12a9 9 0 0 0 9 9 9.75 9.75 0 0 0 6.76-2.51"/><path d="M19 8V3h5"/><path d="M5 16v5h-5"/></svg>
                    <span class="ml-1 hidden sm:inline">é‡æ–°å®šä½</span>
                </button>
            </div>


            <!-- âš™ï¸ ç¯©é¸å™¨ -->
            <div class="flex flex-wrap gap-4 mb-6 p-4 border rounded-xl bg-gray-50">
                
                <!-- åˆé¤/æ™šé¤åˆ‡æ› -->
                <div class="flex-1 min-w-[120px]">
                    <label for="meal-selector" class="text-xs font-semibold text-gray-600 flex items-center mb-1">
                        <!-- Clock Icon -->
                        <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="mr-1"><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></svg>
                        æ™‚æ®µ
                    </label>
                    <select id="meal-selector" class="w-full p-2 border border-gray-300 rounded-lg bg-white focus:ring-indigo-500 focus:border-indigo-500">
                        <option value="åˆé¤">åˆé¤ (Lunch)</option>
                        <option value="æ™šé¤">æ™šé¤ (Dinner)</option>
                    </select>
                </div>
                
                <!-- åƒ¹ä½ç¯©é¸ -->
                <div class="flex-1 min-w-[120px]">
                    <label for="price-filter" class="text-xs font-semibold text-gray-600 flex items-center mb-1">
                        <!-- DollarSign Icon -->
                        <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="mr-1"><line x1="12" x2="12" y1="2" y2="22"/><path d="M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"/></svg>
                        æœ€é«˜åƒ¹ä½
                    </label>
                    <select id="price-filter" class="w-full p-2 border border-gray-300 rounded-lg bg-white focus:ring-indigo-500 focus:border-indigo-500">
                        <option value="5">ğŸ’°ğŸ’°ğŸ’°ğŸ’°ğŸ’° (ä¸é™)</option>
                        <option value="4">ğŸ’°ğŸ’°ğŸ’°ğŸ’° (ä¸­é«˜)</option>
                        <option value="3">ğŸ’°ğŸ’°ğŸ’° (ä¸­ç­‰)</option>
                        <option value="2">ğŸ’°ğŸ’° (å¹³åƒ¹)</option>
                        <option value="1">ğŸ’° (è¶…å€¼)</option>
                    </select>
                </div>

                <!-- è·é›¢ç¯©é¸ -->
                <div class="flex-1 min-w-[120px]">
                    <label for="distance-filter" class="text-xs font-semibold text-gray-600 flex items-center mb-1">
                        <!-- MapPin Icon -->
                        <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="mr-1"><path d="M20 10c0 6-8 12-8 12s-8-6-8-12a8 8 0 0 1 16 0Z"/><circle cx="12" cy="10" r="3"/></svg>
                        æœ€å¤§è·é›¢ (km)
                    </label>
                    <select id="distance-filter" class="w-full p-2 border border-gray-300 rounded-lg bg-white focus:ring-indigo-500 focus:border-indigo-500">
                        <option value="1">1 km</option>
                        <option value="3" selected>3 km</option>
                        <option value="5">5 km</option>
                        <option value="10">10 km</option>
                        <option value="99">ä¸é™è·é›¢</option>
                    </select>
                </div>
            </div>

            <!-- éš¨æ©Ÿé¸æ“‡æŒ‰éˆ• -->
            <button
                id="local-select-btn"
                class="w-full py-3 mb-4 bg-red-500 text-white font-bold text-xl rounded-xl shadow-lg hover:bg-red-600 transition disabled:bg-gray-400 disabled:cursor-not-allowed flex items-center justify-center transform hover:scale-[1.01] active:scale-100"
            >
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="w-5 h-5 mr-2 animate-bounce"><path d="M12.5 17.5 17 21l-5.5-5.5"/><path d="M15 6.5 20 2l-3 3"/><path d="M2 12s2-4 6-4 6 4 6 4"/><path d="M2 12s2 4 6 4 6-4 6-4"/></svg>
                å¾ 0 é–“ä¸­éš¨æ©Ÿé¸æ“‡ï¼
            </button>

            <!-- åº—å®¶åˆ—è¡¨ -->
            <div id="local-stores-list" class="mt-4 space-y-3 max-h-80 overflow-y-auto pr-2 custom-scrollbar">
                <h3 class="text-lg font-semibold text-gray-700">ç¬¦åˆæ¢ä»¶çš„åº—å®¶é è¦½:</h3>
                <div class="text-center text-gray-500 p-4">è³‡æ–™è¼‰å…¥ä¸­...</div>
            </div>
        </section>

    </main>

    <!-- éš¨æ©Ÿçµæœ Modal -->
    <div id="result-modal" class="fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4 hidden">
        <div id="modal-content" class="bg-white rounded-2xl shadow-2xl p-8 w-full max-w-sm text-center transform scale-100 transition-transform duration-300">
            <div class="mb-4">
                <!-- Sparkles Icon -->
                <svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="w-12 h-12 text-yellow-500 mx-auto animate-pulse"><path d="m12 3-1.92 5.8 5.46 3.86-5.46-3.86-1.92 5.8 5.46-3.86-5.46 3.86-1.92-5.8 5.46 3.86-5.46-3.86z"/><path d="m22 17-1.92 5.8 5.46 3.86-5.46-3.86-1.92 5.8 5.46-3.86-5.46 3.86-1.92-5.8 5.46 3.86-5.46-3.86z"/><path d="m18 10-1.92 5.8 5.46 3.86-5.46-3.86-1.92 5.8 5.46-3.86-5.46 3.86-1.92-5.8 5.46 3.86-5.46-3.86z"/></svg>
            </div>
            <h2 id="modal-title" class="text-2xl font-extrabold text-gray-900 mb-2">æ±ºå®šæ˜¯å®ƒäº†ï¼</h2>
            <p id="modal-source" class="text-sm text-gray-500 mb-4">ä¾†è‡ª é™„è¿‘åº—å®¶ çš„æ¨è–¦</p>

            <div class="p-4 bg-yellow-50 rounded-lg border-2 border-yellow-300">
                <p id="modal-restaurant-name" class="text-3xl font-black text-yellow-800"></p>
                <p id="modal-restaurant-cuisine" class="mt-1 text-lg text-yellow-700"></p>
            </div>

            <button
                id="modal-close-btn"
                class="mt-6 w-full py-3 bg-indigo-600 text-white font-semibold rounded-xl hover:bg-indigo-700 transition"
            >
                å¤ªæ£’äº†ï¼Œæˆ‘è¦å»åƒï¼
            </button>
        </div>
    </div>


    <script>
        // =======================================================
        // ğŸ“Œ å…¨åŸŸç‹€æ…‹ (Global State)
        // =======================================================
        const state = {
            userLocation: null,
            localStores: [],
            isLoading: true,
            selectedMeal: 'åˆé¤',
            filters: {
                price: 5,
                maxDistance: 3,
            },
            // æ¨¡æ“¬é™„è¿‘çš„åº—å®¶æ•¸æ“š
            mockLocalRestaurants: [
                { id: 1, name: "å··å£ç‰›è‚‰éºµ", cuisine: "ä¸­å¼", price: 2, distance: 0.5, rating: 4.2 },
                { id: 2, name: "å¥åº·è¼•é£Ÿæ²™æ‹‰", cuisine: "è¥¿å¼", price: 3, distance: 1.2, rating: 4.8 },
                { id: 3, name: "ç¾å‘³æ—¥å¼å®šé£Ÿ", cuisine: "æ—¥å¼", price: 4, distance: 0.3, rating: 3.9 },
                { id: 4, name: "è€ç‹ä¾¿ç•¶åº—", cuisine: "å°å¼", price: 1, distance: 2.5, rating: 4.5 },
                { id: 5, name: "éŸ“å¼ç‚¸é›", cuisine: "éŸ“å¼", price: 3, distance: 0.8, rating: 4.1 },
                { id: 6, name: "å‚³çµ±æ—©é¤åº— (æ™šé¤æ™‚æ®µä¸é–‹)", cuisine: "ä¸­å¼", price: 1, distance: 0.1, rating: 4.0 },
            ],
        };

        // =======================================================
        // ğŸ› ï¸ è¼”åŠ©å·¥å…·å‡½æ•¸ (Helper Functions)
        // =======================================================

        // æ¨¡æ“¬ Supabase æ•¸æ“šç²å–
        const mockFetch = (data, delay = 500) => {
            return new Promise(resolve => setTimeout(() => resolve(data), delay));
        };

        // æ›´æ–°ç‹€æ…‹ä¸¦è§¸ç™¼ UI æ¸²æŸ“
        const setState = (newState) => {
            Object.assign(state, newState);
            updateUI();
        };

        // ---------------------------------------------------
        // UI çµ„ä»¶ç”Ÿæˆå™¨
        // ---------------------------------------------------

        /**
         * ç”Ÿæˆåº—å®¶å¡ç‰‡çš„ HTML
         * @param {Object} store - åº—å®¶æ•¸æ“š
         * @returns {string} HTML å­—ç¬¦ä¸²
         */
        const createStoreCard = (store) => {
            return `
                <div class="p-4 bg-white/70 backdrop-blur-sm rounded-xl shadow-lg border border-gray-100 flex justify-between items-center transform transition duration-300 hover:scale-[1.01]">
                    <div>
                        <h3 class="text-xl font-bold text-gray-800">${store.name}</h3>
                        <p class="text-sm text-gray-500">${store.cuisine}</p>
                        <div class="flex items-center space-x-2 mt-1 text-xs">
                            <span class="flex items-center text-yellow-600">
                                <!-- Star Icon -->
                                <svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 24 24" fill="currentColor" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="mr-1"><polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"/></svg>
                                ${store.rating}
                            </span>
                            ${store.distance ? `<span class="text-blue-500 font-medium">${store.distance.toFixed(1)} km</span>` : ''}
                            <span class="text-green-600">${'ğŸ’°'.repeat(store.price)}</span>
                        </div>
                    </div>
                </div>
            `;
        };

        // ---------------------------------------------------
        // DOM æ›´æ–°å‡½æ•¸ (Update UI)
        // ---------------------------------------------------

        /**
         * æ ¹æ“šç•¶å‰ç‹€æ…‹æ›´æ–°æ‰€æœ‰ç›¸é—œçš„ UI å…ƒç´ ã€‚
         */
        const updateUI = () => {
            const { userLocation, localStores, isLoading, filters, selectedMeal } = state;

            // 1. åœ°ç†ä½ç½®ç‹€æ…‹æ›´æ–°
            const locationEl = document.getElementById('location-status');
            if (userLocation) {
                const icon = userLocation.status && userLocation.status.includes('ç„¡æ³•å®šä½')
                    ? `<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="w-4 h-4 mr-2 text-red-500"><circle cx="12" cy="12" r="10"/><path d="m4.93 4.93 14.14 14.14"/><path d="M16.95 7.05 19.07 4.93"/><line x1="12" x2="12" y1="2" y2="4"/><line x1="12" x2="12" y1="20" y2="22"/></svg>`
                    : `<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="w-4 h-4 mr-2"><path d="M20 10c0 6-8 12-8 12s-8-6-8-12a8 8 0 0 1 16 0Z"/><circle cx="12" cy="10" r="3"/></svg>`;

                locationEl.innerHTML = `
                    ${icon}
                    ${userLocation.status || `ç›®å‰ä½ç½®ï¼šç·¯åº¦: ${userLocation.lat.toFixed(3)}, ç¶“åº¦: ${userLocation.lng.toFixed(3)}`}
                `;
            }

            // 2. ç¯©é¸å¾Œçš„æœ¬åœ°åº—å®¶åˆ—è¡¨
            const filteredLocalStores = localStores.filter(store => {
                if (store.price > filters.price) return false;
                if (store.distance > filters.maxDistance) return false;
                // ç°¡æ˜“çš„æ™‚æ®µç¯©é¸
                if (selectedMeal === 'æ™šé¤' && store.name.includes('æ—©é¤')) return false; 
                return true;
            });

            // 3. æ›´æ–°é™„è¿‘åº—å®¶åˆ—è¡¨
            const localListEl = document.getElementById('local-stores-list');
            const localCountEl = document.getElementById('local-store-count');
            const localBtnEl = document.getElementById('local-select-btn');
            
            localCountEl.textContent = filteredLocalStores.length;
            localListEl.innerHTML = ''; // æ¸…ç©ºåˆ—è¡¨

            if (isLoading) {
                localListEl.innerHTML = '<div class="text-center text-gray-500 p-4">è³‡æ–™è¼‰å…¥ä¸­...</div>';
                localBtnEl.textContent = 'è¼‰å…¥ä¸­...';
                localBtnEl.disabled = true;
            } else if (filteredLocalStores.length === 0) {
                localListEl.innerHTML = '<p class="text-center text-gray-500 p-4">ç„¡ç¬¦åˆæ¢ä»¶åº—å®¶ï¼Œè«‹èª¿æ•´ç¯©é¸æ¢ä»¶ã€‚</p>';
                localBtnEl.textContent = 'ç„¡ç¬¦åˆæ¢ä»¶åº—å®¶';
                localBtnEl.disabled = true;
            } else {
                localBtnEl.innerHTML = `
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="w-5 h-5 mr-2 animate-bounce"><path d="M12.5 17.5 17 21l-5.5-5.5"/><path d="M15 6.5 20 2l-3 3"/><path d="M2 12s2-4 6-4 6 4 6 4"/><path d="M2 12s2 4 6 4 6-4 6-4"/></svg>
                    å¾ ${filteredLocalStores.length} é–“ä¸­éš¨æ©Ÿé¸æ“‡ï¼
                `;
                localBtnEl.disabled = false;
                
                // åƒ…é¡¯ç¤ºå‰ 5 å€‹é è¦½
                const limitedStores = filteredLocalStores.slice(0, 5);
                const listHtml = limitedStores.map(store => createStoreCard(store)).join('');
                
                localListEl.innerHTML = `<h3 class="text-lg font-semibold text-gray-700">ç¬¦åˆæ¢ä»¶çš„åº—å®¶é è¦½:</h3><div class="space-y-3 mt-3">${listHtml}</div>`;
                if (filteredLocalStores.length > 5) {
                    localListEl.innerHTML += `<p class="text-sm text-center text-gray-500 mt-2">... é‚„æœ‰ ${filteredLocalStores.length - 5} é–“ç¬¦åˆæ¢ä»¶çš„åº—å®¶</p>`;
                }
            }
        };

        // ---------------------------------------------------
        // æ ¸å¿ƒé‚è¼¯å‡½æ•¸ (Core Logic)
        // ---------------------------------------------------

        /**
         * è™•ç†åœ°ç†ä½ç½®ç²å– (å› åŸ·è¡Œç’°å¢ƒé™åˆ¶ï¼Œç›´æ¥ä½¿ç”¨é è¨­ä½ç½®)
         * NOTE: å¾ initGeolocation æ›´åç‚º getGeolocation
         */
        const getGeolocation = () => {
            // é è¨­ä½ç½® (å°åŒ— 101 é™„è¿‘)
            const defaultLocation = { 
                lat: 25.033, 
                lng: 121.565, 
                status: 'æ³¨æ„ï¼šç’°å¢ƒé™åˆ¶ç„¡æ³•å®šä½ï¼Œå·²ä½¿ç”¨é è¨­ä½ç½® (å°åŒ— 101 é™„è¿‘)ã€‚' 
            };

            // ç”±æ–¼ Geolocation è¢«ç¦ç”¨ï¼Œæˆ‘å€‘ç›´æ¥ä½¿ç”¨é è¨­ä½ç½®ã€‚
            setState({ userLocation: defaultLocation });
        };

        /**
         * æ¨¡æ“¬è³‡æ–™è¼‰å…¥
         */
        const fetchData = async () => {
            setState({ isLoading: true });
            
            try {
                // æ¨¡æ“¬ç²å–é™„è¿‘çš„åº—å®¶
                const localData = await mockFetch(state.mockLocalRestaurants, 500);
                
                setState({ 
                    localStores: localData,
                });
            } catch (e) {
                console.error('Failed to fetch data:', e);
                // è¼‰å…¥å¤±æ•—ï¼Œä½¿ç”¨å‚™æ´æ•¸æ“š
                setState({ 
                    localStores: state.mockLocalRestaurants,
                });
            } finally {
                setState({ isLoading: false });
            }
        };

        /**
         * éš¨æ©Ÿé¸æ“‡åº—å®¶
         */
        const handleRandomSelect = () => {
            const { localStores, filters, selectedMeal } = state;
            
            // é‡æ–°è¨ˆç®—ç¯©é¸å¾Œçš„åˆ—è¡¨
            const listToChoose = localStores.filter(store => {
                if (store.price > filters.price) return false;
                if (store.distance > filters.maxDistance) return false;
                if (selectedMeal === 'æ™šé¤' && store.name.includes('æ—©é¤')) return false;
                return true;
            });

            let result = null;
            if (listToChoose.length === 0) {
                result = { name: 'ğŸ˜¢ æŠ±æ­‰', cuisine: 'ç„¡ç¬¦åˆæ¢ä»¶çš„åº—å®¶' };
            } else {
                const randomIndex = Math.floor(Math.random() * listToChoose.length);
                result = listToChoose[randomIndex];
            }

            // å›ºå®šä¾†æºåç¨±ç‚ºã€Œé™„è¿‘åº—å®¶ã€
            showResultModal(result, 'é™„è¿‘åº—å®¶');
        };
        
        /**
         * é¡¯ç¤ºçµæœå½ˆçª—
         * @param {Object} result - é¸æ“‡çµæœ
         * @param {string} source - ä¾†æºåç¨±
         */
        const showResultModal = (result, source) => {
            document.getElementById('modal-restaurant-name').textContent = result.name;
            document.getElementById('modal-restaurant-cuisine').textContent = result.name === 'ğŸ˜¢ æŠ±æ­‰' ? '' : result.cuisine;
            document.getElementById('modal-title').textContent = result.name === 'ğŸ˜¢ æŠ±æ­‰' ? result.name : 'æ±ºå®šæ˜¯å®ƒäº†ï¼';
            document.getElementById('modal-source').textContent = result.name === 'ğŸ˜¢ æŠ±æ­‰' ? result.cuisine : `ä¾†è‡ª ${source} çš„æ¨è–¦`;

            document.getElementById('result-modal').classList.remove('hidden');
        };

        /**
         * éš±è—çµæœå½ˆçª—
         */
        const hideResultModal = () => {
            document.getElementById('result-modal').classList.add('hidden');
        };


        // =======================================================
        // ğŸš€ åˆå§‹åŒ–èˆ‡äº‹ä»¶ç›£è½ (Initialization and Event Listeners)
        // =======================================================

        window.onload = () => {
            // 1. åˆå§‹æ•¸æ“šè¼‰å…¥èˆ‡å®šä½
            getGeolocation(); // ç²å–ï¼ˆæˆ–è¨­å®šï¼‰ä½ç½®
            fetchData(); // è¼‰å…¥è³‡æ–™
            
            // 2. ç¯©é¸å™¨äº‹ä»¶ç›£è½
            document.getElementById('meal-selector').addEventListener('change', (e) => {
                setState({ selectedMeal: e.target.value });
            });
            document.getElementById('price-filter').addEventListener('change', (e) => {
                setState({ filters: { ...state.filters, price: parseInt(e.target.value) } });
            });
            document.getElementById('distance-filter').addEventListener('change', (e) => {
                setState({ filters: { ...state.filters, maxDistance: parseInt(e.target.value) } });
            });

            // 3. é‡æ–°å®šä½æŒ‰éˆ•äº‹ä»¶ç›£è½ (æ–°å¢)
            document.getElementById('re-locate-btn').addEventListener('click', () => {
                setState({ isLoading: true }); // é¡¯ç¤ºè¼‰å…¥ç‹€æ…‹
                getGeolocation(); // é‡æ–°è¨­å®šä½ç½® (ç›®å‰ç‚ºæ¨¡æ“¬ä½ç½®)
                fetchData(); // é‡æ–°æ“·å–è³‡æ–™ (æ¨¡æ“¬åˆ·æ–°)
            });
            
            // 4. éš¨æ©Ÿé¸æ“‡æŒ‰éˆ•äº‹ä»¶ç›£è½
            document.getElementById('local-select-btn').addEventListener('click', () => {
                handleRandomSelect();
            });

            // 5. Modal é—œé–‰äº‹ä»¶ç›£è½
            document.getElementById('modal-close-btn').addEventListener('click', hideResultModal);
            document.getElementById('result-modal').addEventListener('click', (e) => {
                // é»æ“ŠèƒŒæ™¯é—œé–‰ Modal
                if (e.target.id === 'result-modal') {
                    hideResultModal();
                }
            });
        };
    </script>
</body>
</html>
